
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="wyyalhz">
      
      
      
        <link rel="prev" href="../part2/">
      
      
        <link rel="next" href="../part4/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>三、数据控制 - BIT数据库期末复习</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="BIT数据库期末复习" class="md-header__button md-logo" aria-label="BIT数据库期末复习" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BIT数据库期末复习
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              三、数据控制
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../overview/" class="md-tabs__link">
          
  
  
  课本复习

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BIT数据库期末复习" class="md-nav__button md-logo" aria-label="BIT数据库期末复习" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    BIT数据库期末复习
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    课本复习
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            课本复习
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课本总览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../part1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    一、数据库的基本概念
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../part2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    二、关系数据库
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    三、数据控制
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    三、数据控制
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1.数据库安全性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.数据库安全性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 数据库的安全性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 数据库系统采用的安全保护措施
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 了解存取控制中用户在不同对象上有哪些权限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-sqldac" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 SQL自主存取控制DAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-sqlmac" class="md-nav__link">
    <span class="md-ellipsis">
      1.5 SQL强制存取控制MAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16" class="md-nav__link">
    <span class="md-ellipsis">
      1.6 视图机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17" class="md-nav__link">
    <span class="md-ellipsis">
      1.7 什么是角色、角色对权限管理有何用处
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2.数据库完整性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.数据库完整性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 定义，关系模型必须满足的完整性约束条件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 理解静态约束和动态约束含义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 完整性约束条件作用对象
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 完整性约束条件作用对象">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      实体完整性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      参照完整性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 用户定义的完整性约束条件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 通过触发器定义完整性约束条件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 违约处理具体措施
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-sql-server" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 SQL Server中完整性的实现
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.7 SQL Server中完整性的实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-server" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Server的触发器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.数据库恢复技术
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.数据库恢复技术">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 事务的基本概念，如何定义，性质
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 数据恢复的基本原理：数据冗余
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 建立冗余数据最常用的技术
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 了解数据转储的基本方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 日志的内容，记日志的规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 故障的种类，对不同故障的恢复策略
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.6 故障的种类，对不同故障的恢复策略">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      事务故障
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      系统故障
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      介质故障
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 检查点恢复技术
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 数据库镜像恢复技术
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 并发控制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 并发控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 丢失更新、不可重复读、读“脏”数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-sx" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 封锁类型：S锁和X锁
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 三级封锁协议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 三级封锁协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      一级封锁协议
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      二级封锁协议
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      三级封锁协议
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 可串行化调度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 两段封锁协议
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 封锁粒度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47" class="md-nav__link">
    <span class="md-ellipsis">
      4.7 多粒度封锁需要解决的问题，意向锁
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../part4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    四、数据库设计
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../part5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    五、数据库新技术
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1.数据库安全性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.数据库安全性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 数据库的安全性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 数据库系统采用的安全保护措施
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 了解存取控制中用户在不同对象上有哪些权限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-sqldac" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 SQL自主存取控制DAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-sqlmac" class="md-nav__link">
    <span class="md-ellipsis">
      1.5 SQL强制存取控制MAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16" class="md-nav__link">
    <span class="md-ellipsis">
      1.6 视图机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17" class="md-nav__link">
    <span class="md-ellipsis">
      1.7 什么是角色、角色对权限管理有何用处
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2.数据库完整性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.数据库完整性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 定义，关系模型必须满足的完整性约束条件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 理解静态约束和动态约束含义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 完整性约束条件作用对象
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 完整性约束条件作用对象">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      实体完整性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      参照完整性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 用户定义的完整性约束条件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 通过触发器定义完整性约束条件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 违约处理具体措施
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-sql-server" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 SQL Server中完整性的实现
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.7 SQL Server中完整性的实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-server" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Server的触发器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.数据库恢复技术
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.数据库恢复技术">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 事务的基本概念，如何定义，性质
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 数据恢复的基本原理：数据冗余
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 建立冗余数据最常用的技术
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 了解数据转储的基本方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 日志的内容，记日志的规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 故障的种类，对不同故障的恢复策略
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.6 故障的种类，对不同故障的恢复策略">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      事务故障
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      系统故障
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      介质故障
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 检查点恢复技术
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 数据库镜像恢复技术
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 并发控制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 并发控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 丢失更新、不可重复读、读“脏”数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-sx" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 封锁类型：S锁和X锁
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 三级封锁协议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 三级封锁协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      一级封锁协议
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      二级封锁协议
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      三级封锁协议
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 可串行化调度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 两段封锁协议
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 封锁粒度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47" class="md-nav__link">
    <span class="md-ellipsis">
      4.7 多粒度封锁需要解决的问题，意向锁
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="_1">三、数据库控制技术</h1>
<h2 id="1">1.数据库安全性</h2>
<h3 id="11">1.1 数据库的安全性</h3>
<p>·数据共享带来数据库的安全性问题</p>
<p>·<strong>数据库的安全性</strong>是指在数据库应用系统的不同层面（数据库系统层、操作系统层、网络层）提供安全防范措施，保护数据库不收恶意访问，<font color=red>完全杜绝几乎是不可能的</font></p>
<p>·TCSED/TDI安全级别划分ABCD四组7个等级：A1，B3，B2，B1，C2，C1，D</p>
<h3 id="12">1.2 数据库系统采用的安全保护措施</h3>
<p>访问控制技术（用户标识与鉴别）</p>
<p>存取控制技术</p>
<p>视图</p>
<p>数据加密</p>
<p>数据库审计</p>
<h3 id="13">1.3 了解存取控制中用户在不同对象上有哪些权限</h3>
<p>·存取控制：只允许用户进行权限范围内的数据存取操作，最有效的安全手段，包括定义用户权限和合法权限检查，分为自主存取控制（C2级）和强制存取控制（B1级）</p>
<p>各个数据对象所允许的操作：</p>
<table>
<thead>
<tr>
<th>数据对象</th>
<th>操作类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>模式</td>
<td>CREATE SCHEMA，DROP</td>
</tr>
<tr>
<td>基本表</td>
<td>CREATE TABLE，ALTER TABLE，DROP</td>
</tr>
<tr>
<td>视图</td>
<td>CREATE VIEW，DROP</td>
</tr>
<tr>
<td>索引</td>
<td>CREATE INDEX，DROP</td>
</tr>
<tr>
<td>表和视图的元组</td>
<td>SELECT，INSERT，UPDATE，DELETE，REFERENCES，ALL PRIVILEGES</td>
</tr>
<tr>
<td>属性列</td>
<td>SELECT，INSERT，UPDATE，DELETE，REFERENCES，ALL PRIVILEGES</td>
</tr>
</tbody>
</table>
<h3 id="14-sqldac">1.4 SQL自主存取控制DAC</h3>
<p><strong>数据库角色</strong>：<font color=red>权限的集合</font></p>
<pre><code class="language-sql">//创建一个角色
CREATE ROLE R1;

//授予角色R1拥有三个关系的查询权限
GRANT SELECT ON TABLE STUDENT, SC, COURSE TO R1;

//将角色R1授予用户Li和Zhao，使它们具有角色R1所包含的全部权限
GRANT R1 TO Li, Zhao;

</code></pre>
<h3 id="15-sqlmac">1.5 SQL强制存取控制MAC</h3>
<p>·分为主体和客体，主体包括DBMS所管理的实际用户和代表用户的各进程，客体包括文件、数据表、视图、记录、属性列等等</p>
<p>·主体的安全分类级别成为许可证级别，客体的安全分类级别成为密集</p>
<p>·控制规则：</p>
<ul>
<li>仅当主题的许可证级别<font color=red>大于或等于</font>客体的密集时，主体才能读取客体（上读）</li>
<li>仅当主题的许可证级别<font color=red>等于或小于</font>客体的密集时，主体才能写客体（下写）</li>
</ul>
<p>·一般用户或程序不能修改系统安全收取那状态，只有特定的系统权限管理员才可以这么做，提供了更高级别的安全性，但也有诸多不便</p>
<h3 id="16">1.6 视图机制</h3>
<p>·主要功能是<strong>提供数据独立性</strong>，同时<font color=red>也是一种重要的自主授权机制</font>，安全保护功能并不精细</p>
<p>·视图可实现的安全保护：
- 将用户限定在数据表中特定的数据行上
- 将用户限定在数据表中特定的数据列上
- 将多个表中的列连接起来，使他们看起来像一个数据表
- 提供聚合信息而非详细信息</p>
<p>·视图与授权机制配合
- 用视图屏蔽掉一部分保密数据，进一步定义存取权限
- 通过定义不同的视图及有选择地授予视图上的权限，可以将用户、组、角色限制在不同的数据子集内</p>
<h3 id="17">1.7 什么是角色、角色对权限管理有何用处</h3>
<p><strong>数据库角色</strong>：<font color=red>权限的集合</font></p>
<p>·用户数量比较大的情况下，可以为一组组具有相同权限的用户创建一个角色，简化授权的过程</p>
<h2 id="2">2.数据库完整性</h2>
<h3 id="21">2.1 定义，关系模型必须满足的完整性约束条件</h3>
<p>·含义：正确性、有效性、相容性（表示同一事实的两个数据应相同）</p>
<p>·关系数据库对数据的各种限制是以完整性约束条件的形式<font color=red>在关系数据库模式中</font>指定的</p>
<p>·关系数据库完整性约束条件分为：
- 实体完整性约束
- 参照完整性约束
- 其他（用户定义的）完整性约束</p>
<p>·关系数据库中，<strong>完整性控制策略</strong>包括默认值、规则、<font color=red>约束（优先于触发器、规则和默认值）</font>、<font color=red>触发器（编程的方法）</font>和存储过程等</p>
<p>·数据完整性另一分类：
- 声明式数据完整性（非编程方式）：约束、默认值、规则
- 过程式数据完整性（编程方式）：触发器、存储过程</p>
<h3 id="22">2.2 理解静态约束和动态约束含义</h3>
<h3 id="23">2.3 完整性约束条件作用对象</h3>
<ul>
<li>关系（关系约束）：一个关系的各个元组之间、或者多个关系之间存在的各种联系或约束。常见的关系约束有：实体完整性约束、参照完整性约束、函数依赖约束、统计约束等</li>
<li>元组（元组约束）：元组中各个属性之间的约束关系</li>
<li>属性列（列级约束）：对数据类型、格式、值域、空值的约束</li>
</ul>
<h4 id="_2">实体完整性</h4>
<p>·规定：主键的值唯一，不能取空值</p>
<p>·用PRIMARY KEY定义，可以定义为列级约束条件或标记约束条件，对多个属性构成的主键只能定义为表级约束条件</p>
<pre><code class="language-sql">CREATE TABLE SC (
    Sno CHAR(10) NOT NULL,
    Cno CHAR(4) NOT NULL,
    Grade SMALLINT,
    PRIMARY KEY (Sno, Cno) //只能在表级定义主键
);
</code></pre>
<p>·系统一般会在主键属性上自动创建唯一的索引来强制唯一性约束</p>
<h4 id="_3">参照完整性</h4>
<p>·规定：不允许引用不存在的元组；外键字段的值要么为空值要么是被引用关系中元组的对应值</p>
<ul>
<li>FOREIGN KEY定义哪些列为外键，</li>
<li>REFERENCES短语指明外键参照哪些表的主键</li>
</ul>
<pre><code class="language-sql">CREATE TABLE SC (
    Sno CHAR(10) NOT NULL,
    Cno CHAR(4) NOT NULL,
    Grade SMALLINT,
    PRIMARY KEY (Sno, Cno),
    FOREIGN KEY (Sno) REFERENCES STUDENT(Sno),
    FOREIGN KEY (Cno) REFERENCES COURSE(Cno)
);
</code></pre>
<p>·维护参照完整性的策略：</p>
<p>1.参照关系中，需要定义外键是否允许为空值</p>
<p>2.参照关系中，插入元组有<strong>受限插入</strong>和<strong>递归插入</strong>（级联CASCADE插入）两种</p>
<p>3.参照关系中，修改元组：先删除、再插入</p>
<p>4.被参照关系中，删除元组有级联删除CASCADES、受限删除RESTRICTED、置空值删除</p>
<p>5.被参照关系中，修改主键：先删除、再插入</p>
<p>·违反参照完整性，系统一般选用默认策略，即拒绝执行。如果想让系统采用其他策略，则必须在创建表时加以说明</p>
<h3 id="24">2.4 用户定义的完整性约束条件</h3>
<p>·是限定某一具体应用的数据必须满足的语义要求，由RDBMS提供定义和检验用户定义的完整性的机制</p>
<p>·用户定义的完整性的定义：
- 属性上的约束条件的兴义：唯一（UNIQUE）、非空（NOT NULL）、CHECK约束、默认值DEFAULT等
- 元组上的约束条件的定义：用CHECK短语，元组级的限制可以设置不同属性之间的相互约束条件</p>
<pre><code class="language-sql">//创建table1，指定c1字段不能包含重复值，c2字段只能取特定值
CREATE TABLE table1 (
    c1 CHAR(2) UNIQUE,
    c2 CHAR(2) CHECK (c2 IN ('00', '01', '02', '03')),
    c3 INT DEFAULT 1
    );

//定义CONSTRANT约束
CRAETE TABLE Student (
    Sno NUMBERIC(6) CONSTRAINT C1 CHECK (Sno BETWEEN 100000 AND 999999),
    Sname CHAR(20) CONSTRAINT C2 NOT NULL,
    Sage NUMBERIC(3) CONSTRAINT C3 CHECK (Sage BETWEEN 18 AND 60),
    Ssex CHAR(2) CONSTRAINT C4 CHECK (Ssex IN ('男', '女')),
    CONSTRAINT PK_Student PRIMARY KEY (Sno)
);

//修改表中的完整性限制：先删除原来的约束条件，再加新的
//修改表Student中的约束条件，年龄改为小于40
ALTER TABLE Student DROP CONSTRAINT C3;
ALTER TABLE Student ADD CONSTRAINT C3 CHECK (Sage &lt; 40);
</code></pre>
<h3 id="25">2.5 通过触发器定义完整性约束条件</h3>
<table>
<thead>
<tr>
<th>约束</th>
<th>触发器</th>
</tr>
</thead>
<tbody>
<tr>
<td>声明式、静态的</td>
<td>过程式、动态的</td>
</tr>
<tr>
<td>只能实现简单动作如拒绝操作</td>
<td>可以实现复杂的完整性约束</td>
</tr>
<tr>
<td></td>
<td>由事件驱动的特殊过程，在对表或视图发出UPDATE、INSERT或DELETE时自动执行</td>
</tr>
<tr>
<td></td>
<td>也叫<font color=red>事件-条件-动作</font>规则</td>
</tr>
</tbody>
</table>
<p>·示例</p>
<pre><code class="language-sql">CREATE TRIGGER SC_T
  AFTER UPDATE OF Grade ON SC 
  REFERENCING
    OLD row AS OldTuple,
    NEW row AS NewTuple
  FOR EACH ROW
  WHEN (NewTuple.Grade &gt;= 1.1*OldTuple.Grade)
    INSERT INTO
      SC_U(Sno, Cno, OldGrade, NewGrade)
    VALUES
      (OldTuple.Sno, OldTuple.Cno, OldTuple.Grade, NewTuple.Grade);

</code></pre>
<p>1.触发器的创建者：表拥有者或创建表的用户才可以在表上创建触发器，一个表上可以创建多个触发器</p>
<p>2.表名：触发器的目标表，更新时触发器才被激活</p>
<p>3.触发事件：INSERT、UPDATE、DELETE，或三者组合</p>
<p>4.触发时间：BEFORE、AFTER、INSTEAD OF</p>
<p>5.触发器类型：按照<font color=red>触发动作的间隔</font>分为
- 行级触发器FOR EACH ROW：对每一个修改的元组都会触发触发器
- 语句级触发器FOR EACH STATEMENT：只在SQL语句执行时触发</p>
<p>6.触发条件：由WHEN子句指定</p>
<p>7.触发动作体</p>
<p>8.引用
REFERENCING NEW | OLD ROW AS &lt;变量&gt;，行级触发器，在过程体中引用事件之后的新值和事件之前的旧值</p>
<p>REFERENCING NEW | OLD TABLE AS &lt;变量&gt;，语句级触发器，<font color=red>仅适用于AFTER触发器</font>，在过程体中引用整个表的新值和旧值</p>
<p>·实例</p>
<pre><code class="language-sql">//定义一个BEFORE行级触发器，为教师表Teacher定义完整性规则“教授的工资不得低于4000元，如果低于4000元，自动改为4000元”

CREATE TRIGGER Insert_Or_Update_Sal
  BEFORE INSERT OR UPDATE ON Teacher
  FOR EACH ROW
  BEGIN
    IF (new.Job = '教授') AND (new.Salary &lt; 4000)
      THEN new.Sal := 4000;//:=表示赋值
    END IF;
  END;

//将每次对表Student的插入操作所增加的学生个数记录到表StudentInsertLog中

CREATE TRIGGER Student_Count(
    AFTER INSERT ON Student
    REFERENCING NEW TABLE AS Delta
    FOR EACH STATEMENT
      INSERT INTO StudentInsertLog(Numbers)
      SELECT COUNT(*) FROM Delta;
)

//删除触发器
DROP TRIGGER Student_Count ON Student;

</code></pre>
<h3 id="26">2.6 违约处理具体措施</h3>
<p>·触发器执行顺序：
- 1.执行该表上的BEFORE触发器
- 2.激活触发器的SQL语句（触发事件）
- 3.执行该表上的AFTER触发器</p>
<p>·如果激活触发器的SQL语句违反了约束条件，则不会执行AFTER触发器</p>
<h3 id="27-sql-server">2.7 SQL Server中完整性的实现</h3>
<p>·<font color=red>使用约束CONSTRANT优先于使用触发器、规则和默认值</font>：</p>
<p>·<font color=red>CHECK约束中不能包含子查询</font>：</p>
<pre><code class="language-sql">ALTER TABLE Employees 
  ADD CONSTRAINT CK_birthdate 
  CHECK (BirthDate &gt; '01-01-1900' AND BirthDate &lt; getdate());

ALTER TABLE Employees
  ADD CONSTRAINT FK_Orders_Customers
  FOREIGN KEY (CustomerID) 
  REFERENCES Customers(CustomerID)

ALTER TABLE Employees
  ADD CONSTRAINT DF_contactname
    DEFAULT 'unknown'
  FOR ContactName;

ALTER TABLE Employees
  ADD CONSTRAINT U_CompanyName
    UNIQUE (CompanyName);
</code></pre>
<p>·UNIQUE约束
- 使用唯一性约束的字段允许为空值
- 唯一性约束用于强制在指定字段上创建一个唯一性索引</p>
<h4 id="sql-server">SQL Server的触发器</h4>
<p>·与之前学的触发器格式稍有不同</p>
<p>·<font color=red> 临时虚拟表 </font>:
- INSERTED表：保存INSERT操作中新插入的数据或UPDATE操作中更新后的数据
- DELETED表：保存DELETE操作中删除的数据或UPDATE操作更新前的数据
- 触发器操作完后相关临时表自动删除</p>
<pre><code class="language-sql">//创建删除触发器，当删除一本书时，先检查这本书是否已经被卖过了，即是否和订单关联，如果已经有关联则概述的信息并不能被删除，删除动作需要回滚。

CREATE TRIGGER Products_Delete
  ON Products FOR DELETE
AS
  IF(SELECT COUNT(*) 
    FROM [Order Details] INNER JOIN deleted
      ON [Order Details].ProductID = deleted.ProductID) &gt; 0
  BEGIN
    RAISERROR('该书已经被卖出，不能删除', 10, 1)
    ROLLBACK TRANSACTION
  END

//创建限制更新数据的触发器，限制将SC表中不及格学生的成绩改为及格

CREATE TRIGGER tri_grade
  ON SC FOR UPDATE
AS
  IF UPDATE (Grade)
    IF EXISTS (SELECT * FROM INSERTED JOIN DELETED ON
      INSERTED.Sno = DELETED.Sno WHERE INSERTED.Grade &gt;= 60 AND DELETED.Grade &lt; 60)
    BEGIN
      RAISERROR('不及格学生的成绩不能修改')
      ROLLBACK
    END

</code></pre>
<h2 id="3">3.数据库恢复技术</h2>
<h3 id="31">3.1 事务的基本概念，如何定义，性质</h3>
<p><strong>事务</strong>：用户定义的一个数据库操作序列，不可分割的工作单位，要么全做，要么全不做。在关系数据库中，一个事务可以是一条SQL语句，一组SQL语句或整个程序</p>
<p>·定义事务</p>
<pre><code class="language-sql">BEGIN TRANSACTION
  //事务内的SQL语句
  //……
COMMIT | ROLLBACK
</code></pre>
<ul>
<li>COMMIT表示提交，事务中所有操作结果被保存</li>
<li>ROLLBACK表示回滚，事务中所有已完成的操作都被撤销，数据库回到事务开始前的状态</li>
</ul>
<pre><code class="language-sql">//例：银行转账事务的定义
BEGIN TRANSACTION
  read(A);
  A:=A-1000;
  wirte(A);
  if(A&lt;0) ROLLBACK;
  else{
    read(B);
     B:=B+1000;
     write(B);
     COMMIT;
  }
</code></pre>
<p>·事务的性质：<font color=red> ACID特性 </font>，即
- 原子性：事务不可分割，要么全部完成，要么全部不完成
- 一致性：事务必须使数据库从一个一致性状态变到另一个一致性状态。<strong>一致性状态</strong>：数据库中只包含成功执行的事务所提交的结果
- 隔离性：一个事务的执行不能影响另一个事务，保证并发执行结果正确
- 持久性：一个事务一旦提交，它对数据库的改变就应该永久保存下来</p>
<h3 id="32">3.2 数据恢复的基本原理：数据冗余</h3>
<p>·原理：利用存储在系统其他地方的冗余数据来重建数据库中已被破坏或不正确的那部分数据</p>
<h3 id="33">3.3 建立冗余数据最常用的技术</h3>
<p>·<strong>数据转储</strong>和<strong>登记日志文件</strong>。通常一起使用</p>
<h3 id="34">3.4 了解数据转储的基本方法</h3>
<p>·DBA定期地将整个数据库复制到磁带或领一个磁盘上保存，后背副本，只能将数据库恢复到转储时的状态</p>
<p><img alt="3-3-4-1.jpg" src="../assets/images/3-3-4-1.jpg" /></p>
<ul>
<li>
<p>静态存储：在系统中无运行事务时进行存储，但过程中不允许存取、修改数据库</p>
</li>
<li>
<p>动态存储：与用户事务并发进行，期间允许存取、修改数据库，但不能保证副本数据正确有效，需要配合日志恢复</p>
</li>
<li>
<p>海量存储：每次转储全部数据库</p>
</li>
<li>
<p>增量存储：只转储自上次转储后<font color=red>更新过的数据</font></p>
</li>
</ul>
<h3 id="35">3.5 日志的内容，记日志的规则</h3>
<p>·内容：事务标识、操作类型、操作对象、更新前后的数据值</p>
<p>·登记日志文件时必须遵循两条原则：
- 登记的次序严格按并行事务执行的时间次序；
- 必须先写日志文件，厚些数据库</p>
<h3 id="36">3.6 故障的种类，对不同故障的恢复策略</h3>
<h4 id="_4">事务故障</h4>
<p>·事务在运行至正常终止点前被终止</p>
<p>·恢复方法：利用日志文件撤销事务对数据的更改，系统回滚到事务执行前的状态。</p>
<p>·事务故障的恢复由<font color=red>系统自动完成</font></p>
<h4 id="_5">系统故障</h4>
<p>·一些未完成事务对数据库的更新已写入数据库/一些已提交事务对数据库的更新还留在缓冲区没来得及写入数据库，造成数据库不一致状态</p>
<p>·恢复方法：正向扫描日志建立Redo和Undo队列，Undo未完成的事务，Redo已完成的事务</p>
<p>·由系统在<font color=blue>重新启动时</font> <font color=red>自动完成</font>，不需要用户干预</p>
<h4 id="_6">介质故障</h4>
<p>·介质上存储的数据受到破坏</p>
<p>·恢复方法：重装数据库，使数据库恢复到某个一致性状态，重做已完成的事务</p>
<p>·单用日志不能恢复，需要后背副本；<font color=red>需要DBA介入，具体恢复操作仍由DBMS完成</font></p>
<h3 id="37">3.7 检查点恢复技术</h3>
<p>·背景：为了提高回复效率，允许恢复子系统在登记日志期间动态维护日志，为此在日志文件中增加检查点记录、增加重启动文件（重新开始文件）</p>
<p>·<font color=red>检查点</font>：记录在日志中、表示数据库是否正常运行的一个标志，记录所有当前活动事务的相关信息</p>
<p>·检查点记录的内容：
- 建立检查点时所有正在执行的事务清单
- 这些事务在日志中最近一个记录的地址</p>
<p>·<font color=red>重启动文件</font>：记录各个“检查点记录”在日志文件中的地址</p>
<p>·写检查点的步骤：
- 1.把日志缓冲区的内容写入日志文件
- 2.在日志文件中写入一个检查点记录
- 3.把数据库缓冲区的内容写入数据库
- 4.把检查点记录在日志文件的地址写入重启动文件</p>
<p>·遵循“日志记录优先写入”原则，写检查点过程中不允许事务执行任何更新操作</p>
<p>·利用检查点的恢复步骤：
<img alt="3-3-7-1.jpg" src="../assets/images/3-3-7-1.jpg" /></p>
<h3 id="38">3.8 数据库镜像恢复技术</h3>
<p>·<strong>数据库镜像</strong>：DBMS自动把整个数据库或其中的关键数据复制到另一个磁盘上，自动保证镜像数据与主数据的一致性</p>
<p>·出现介质故障时，可由镜像磁盘继续提供服务，同时DBMS自动利用镜像磁盘数据进行数据库的恢复，不需要关闭系统和重装数据库副本</p>
<h2 id="4">4 并发控制</h2>
<h3 id="41">4.1 丢失更新、不可重复读、读“脏”数据</h3>
<table>
<thead>
<tr>
<th>丢失更新</th>
<th>不可重复读</th>
<th>读“脏”数据</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="3-4-1-1.jpg" src="../assets/images/3-4-1-1.jpg" /></td>
<td><img alt="3-4-1-2.jpg" src="../assets/images/3-4-1-2.jpg" /></td>
<td><img alt="3-4-1-3.jpg" src="../assets/images/3-4-1-3.jpg" /></td>
</tr>
<tr>
<td>事务2的提交结果破坏了事务1提交的结果</td>
<td>事务1的两次读取结果不一致</td>
<td>事务1读取到事务2未提交的中间结果</td>
</tr>
</tbody>
</table>
<h3 id="42-sx">4.2 封锁类型：S锁和X锁</h3>
<p><strong>共享锁（S锁）</strong>
- 若事务T对数据对象A加上S锁，则其他事物只能再对A加S锁，而不能加X锁，直到T释放A上的S锁
- 保证其他事务可以读A，但在T释放A上的S锁之前不能对A做任何修改</p>
<p><strong>排它锁（X锁）</strong>
- 若事务T对数据对象A加上X锁，则只允许T读取和修改A，其他任何事务都不能再对A加任何类型的锁，直到T释放A上的锁</p>
<h3 id="43">4.3 三级封锁协议</h3>
<h4 id="_7">一级封锁协议</h4>
<p>·事务T在修改数据A前必须对其加X锁，直到事务结束才释放。</p>
<p>·<font color=red>做到了</font>：没有修饰更新</p>
<p>·<font color=red>没做到</font>：不能保证可重复读和不读脏数据</p>
<h4 id="_8">二级封锁协议</h4>
<p>·在一级封锁协议的基础上，规定：事务T在读数据A之前必须先对其加S锁，读完后即可释放S锁</p>
<p>·<font color=red>做到了</font>：防止读脏数据</p>
<p><font color=red>没做到</font>：不能避免不可重复读</p>
<h4 id="_9">三级封锁协议</h4>
<p>·在二级封锁协议的基础上，规定：某一事务施加的S锁要保持到该事物结束才释放</p>
<p>·<font color=red>做到了</font>：可重复读</p>
<p>·<font color=red>没做到</font>：效率不高</p>
<h3 id="44">4.4 可串行化调度</h3>
<p>·不同的事务调度可能会产生不同的结果，多个事务交叉执行（并发）结果<font color=red>与某个穿行执行结果相同</font>，则正确，该调度称为可串行化调度。<font color=red>可串行化石并发事务正确调度的准则</font></p>
<p><img alt="3-4-4-1.jpg" src="../assets/images/3-4-4-1.jpg" /></p>
<p>·当前仅当优先图中没有回路时，调度S才是可串行化的</p>
<h3 id="45">4.5 两段封锁协议</h3>
<p><strong>活锁与死锁</strong></p>
<p><img alt="3-4-5-1.jpg" src="../assets/images/3-4-5-1.jpg" /></p>
<table>
<thead>
<tr>
<th>活锁</th>
<th>死锁</th>
</tr>
</thead>
<tbody>
<tr>
<td>某个事务总也得不到锁而长期处于等待状态</td>
<td><font color=red>各自部分封锁+互相等待</font></td>
</tr>
</tbody>
</table>
<p>·预防思索：一次封锁法、顺序封锁法、事务重试法</p>
<p><strong>一次封锁法</strong>：</p>
<ul>
<li>
<p>每个事务在开始执行之前获得所有数据项上的锁</p>
</li>
<li>
<p>不存在持锁等待，不会发生死锁</p>
</li>
<li>
<p>问题：降低了系统的并发度，很难事先精确地确定每个事务要封锁的对象</p>
</li>
</ul>
<p><strong>两阶段封锁协议</strong>
- 任何事务在对数据进行操作前必须先获得锁
- 一个事务所有的封锁操作都在第一个解锁操作之前</p>
<p>·事物的执行分为两个阶段
- 第一阶段：获得锁阶段，也称为扩张阶段，事务可以申请获得任何数据上任何类型的锁，也可以进行锁的升级转换，但不能释放任何锁
- 第二阶段：释放锁阶段，也称为收缩阶段，事务可以释放任何数据项上的任何类型的锁，也可以进行锁的降级转换，但是不能再申请任何锁。</p>
<table>
<thead>
<tr>
<th>图示</th>
<th>举例</th>
<th>死锁情况</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="3-4-5-2.jpg" src="../assets/images/3-4-5-2.jpg" /></td>
<td><img alt="3-4-5-3.jpg" src="../assets/images/3-4-5-3.jpg" /></td>
<td><img alt="3-4-5-4.jpg" src="../assets/images/3-4-5-4.jpg" /></td>
</tr>
<tr>
<td></td>
<td>所遵守两阶段封锁协议的事务，其并行执行的结果也一定是正确的，是可串行化调度的充分条件</td>
<td>不能避免死锁，因为并不要求事务必须一次将所有要用的数据全部加锁</td>
</tr>
</tbody>
</table>
<p>·为了避免死锁，采用一次封锁法，将2PL改成保守的2PL：事务在操作执行前获得所有操作数据上的锁，一次性封锁所有数据项，否则等待。不会产生死锁，但难以实现，因为修要预先知道事务所需要处理的数据。</p>
<h3 id="46">4.6 封锁粒度</h3>
<p><strong>封锁粒度</strong>：封锁对象的大小
- 逻辑单元：属性列、元组、关系（表）、索引项、整个索引、整个数据库等
- 物理单元：页（数据页或索引页）、物理记录、数据库存储空间等</p>
<p><font color=red>
·封锁粒度越小，并发度越高，需要的锁越多，系统开销越大</p>
<p>·封锁粒度越大，并发度越低，需要的锁越少，系统开销越小
</font></p>
<p><strong>多粒度树</strong>：以树形结构来表示多级封锁粒度，根节点是整个数据库表示最大的数据粒度</p>
<p><strong>多粒度封锁协议</strong>：
- 允许多粒度树中的每个结点被独立地枷锁
- 对一个结点加锁意味着这个结点的所有后裔节点也被加以同样类型的锁
- 两种封锁方式（效果一样）：<strong>显示封锁</strong>是直接加到数据对象上的封锁，<strong>隐式封锁</strong>是由于其上级结点加锁而使该数据对象加上了锁</p>
<h3 id="47">4.7 多粒度封锁需要解决的问题，意向锁</h3>
<p>·<font color=red>既要检查显示封锁，还要检查隐式封锁，检查的内容多、效率低</font></p>
<p><strong>意向锁</strong>
- 对任一结点加基本所，必须先对他的上层结点加意向锁；
- 如果对一个结点加意向锁，则说明该结点的某个下层结点正在被加锁</p>
<p><strong>意向共享锁IS锁</strong>：如果对一个数据加IS锁，表示它的后裔节点拟（意向）加S锁</p>
<p><strong>意向排它锁IX锁</strong>：如果对一个数据加IX锁，表示它的后裔节点拟（意向）加X锁</p>
<p><strong>共享意向排它锁SIX锁</strong>：如果对一个数据加SIX锁，表示对它加S锁，再加IX锁，即SIX=S+IX（该事务要读整个表，同时会更新个别元组）</p>
<table>
<thead>
<tr>
<th>相容性和封锁强度</th>
<th>封锁方法</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="3-4-7-1.jpg" src="../assets/images/3-4-7-1.jpg" /></td>
<td><img alt="3-4-7-2.jpg" src="../assets/images/3-4-7-2.jpg" /></td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.index", "navigation.sections", "navigation.expand", "navigation.top", "content.code.copy", "search.highlight"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>